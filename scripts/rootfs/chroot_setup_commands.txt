sudo apt update
sudo apt install -y qemu
apt-mark hold $(dpkg -l | grep 'nvidia-l4t-' | awk '{print $2}')
sudo apt upgrade -y || true
apt-mark unhold $(dpkg -l | grep 'nvidia-l4t-' | awk '{print $2}')
apt-mark hold nvidia-l4t-kernel nvidia-l4t-kernel-headers nvidia-l4t-kernel-dtbs nvidia-l4t-firmware nvidia-l4t-xusb-firmware
sudo apt autoremove -y
echo "Installing apt packages"
apt install -y python3-pip ifupdown v4l-utils apt-utils tree fail2ban tmux vim
apt install -y screen htop can-utils iptraf libqt5core5a cmake libssl-dev
apt install -y libc6-dev build-essential libudev-dev libqmi-utils uhubctl ffmpeg
apt install -y libqt5widgets5 uuid-runtime nvme-cli nvidia-container-runtime
apt install -y nvidia-docker2 nvidia-cuda chrony nano git python3-libnvinfer-dev
pip install -U sphinx python-can
echo "Installing viki"
python3 -m pip install /root/packages/cartken-wheels/viki-*.whl
echo "Installing cartken debians"
dpkg -i --force-overwrite /root/packages/cartken-jetson-debians/cartken-jetson-can-setup.deb
dpkg -i --force-overwrite /root/packages/cartken-jetson-debians/cartken-jetson-can-interface.deb
dpkg -i --force-overwrite /root/packages/cartken-jetson-debians/cartken-jetson-wifi-kernel-modules.deb
dpkg -i --force-overwrite /root/packages/cartken-jetson-debians/cartken-jetson-wifi-access-point.deb
dpkg -i --force-overwrite /root/packages/cartken-jetson-debians/cartken-jetson-modem-kernel-modules.deb
dpkg -i --force-overwrite /root/packages/cartken-jetson-debians/cartken-wifi-tools.deb
dpkg -i --force-overwrite /root/packages/cartken-jetson-debians/cartken-jetson-wifi-manager.deb
dpkg -i --force-overwrite /root/packages/cartken-jetson-debians/cartken-networking-base.deb
dpkg -i --force-overwrite /root/packages/cartken-jetson-debians/cartken-vpn-common-credentials.deb
dpkg -i --force-overwrite /root/packages/cartken-jetson-debians/cartken-vpn-initial-credentials.deb
dpkg -i --force-overwrite /root/packages/cartken-jetson-debians/cartken-vpn-initial.deb
sed -i 's/^#\?\(PermitRootLogin\).*/\1 yes/' /etc/ssh/sshd_config
echo "root:$(openssl passwd -6 cartken)" | chpasswd -e
